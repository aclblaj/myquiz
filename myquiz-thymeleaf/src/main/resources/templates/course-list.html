<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Courses List</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
</head>
<body>

<div th:insert="~{fragments::menu}"></div>

<div class="container mt-3">
    <h2>Courses</h2>

    <div th:if="${message}" style="color: #fff; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 16px; padding: 1rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);" th:text="${message}"></div>

    <!-- Search Filter Section -->
    <div class="searchfilter">
        <form method="post" th:action="@{/courses/filter}" class="searchfilter-form">
            <div>
                <label for="courseFilter" class="searchfilter-label">Course</label>
                <select id="courseFilter" name="selectedCourse" class="searchfilter-select">
                    <option value="">All Courses</option>
                    <option th:each="course : ${courses}"
                            th:value="${course.course}"
                            th:text="${course.course}"
                            th:selected="${course.course} == ${selectedCourse}"></option>
                </select>
            </div>
            <div>
                <label for="yearFilter" class="searchfilter-label">University Year</label>
                <select id="yearFilter" name="selectedYear" class="searchfilter-select">
                    <option value="">All Years</option>
                    <option th:each="year : ${years}"
                            th:value="${year}"
                            th:text="${year}"
                            th:selected="${year} == ${selectedYear}"></option>
                </select>
            </div>
            <div>
                <label for="pageSize" class="searchfilter-label">Page Size</label>
                <select id="pageSize" name="pageSize" class="searchfilter-select">
                    <option th:selected="${pageSize == 5}" value="5">5</option>
                    <option th:selected="${pageSize == 10}" value="10">10</option>
                    <option th:selected="${pageSize == 20}" value="20">20</option>
                    <option th:selected="${pageSize == 50}" value="50">50</option>
                </select>
            </div>
            <div>
                <label for="currentPage" class="searchfilter-label">Page</label>
                <input type="number" id="currentPage" name="currentPage"
                       th:value="${currentPage != null ? currentPage : 1}"
                       min="1"
                       class="searchfilter-select" style="width: 80px;" />
            </div>
            <button type="submit" class="btn-filter">ğŸ” Filter Courses</button>
        </form>
    </div>

    <!-- Error Message -->
    <div th:if="${errorMessage}" style="color: #fff; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 16px; padding: 1rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);" th:text="${errorMessage}"></div>

    <!-- Styled Table -->
    <table class="styled-table">
        <thead>
        <tr>
            <th>Id</th>
            <th>Course Name</th>
            <th>Description</th>
            <th>University Year</th>
            <th>Semester</th>
            <th>Study Year</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="course : ${courses}" class="data-row">
            <td th:text="${course.id}"></td>
            <td th:text="${course.course}"></td>
            <td th:text="${course.description}"></td>
            <td th:text="${course.universityYear}"></td>
            <td th:text="${course.semester}"></td>
            <td th:text="${course.studyYear}"></td>
            <td class="action-cell">
                <a th:href="@{'/courses/' + ${course.id}}" class="btn btn-info">ğŸ‘ï¸ View</a>
                <a th:href="@{'/courses/edit/' + ${course.id}}" class="btn btn-edit">âœï¸ Edit</a>
                <a th:href="@{'/quiz/course/name/' + ${course.course}}" class="btn btn-info">ğŸ“ Quizzes</a>
                <a th:href="@{'/courses/' + ${course.id} + '/delete'}" class="btn btn-delete" onclick="return confirm('Are you sure you want to delete this course? This will also delete all associated quizzes and questions. This action cannot be undone.')">ğŸ—‘ï¸ Delete</a>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(courses)}" class="empty-row">
            <td colspan="7">No courses found for the selected criteria</td>
        </tr>
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="pagination-controls" th:if="${totalPages != null && totalPages > 1}">
        <div style="display: flex; align-items: center; gap: 10px;">
            <!-- First Button -->
            <a th:if="${currentPage != null && currentPage > 1}"
               th:href="@{/courses(selectedCourse=${selectedCourse}, selectedYear=${selectedYear}, currentPage=1, pageSize=${pageSize})}"
               class="btn btn-outline">â®ï¸ First</a>
            <span th:if="${currentPage == null || currentPage <= 1}" class="btn btn-outline disabled">â®ï¸ First</span>

            <!-- Previous Button -->
            <a th:if="${currentPage != null && currentPage > 1}"
               th:href="@{/courses(selectedCourse=${selectedCourse}, selectedYear=${selectedYear}, currentPage=${currentPage - 1}, pageSize=${pageSize})}"
               class="btn btn-outline">â¬…ï¸ Previous</a>
            <span th:if="${currentPage == null || currentPage <= 1}" class="btn btn-outline disabled">â¬…ï¸ Previous</span>

            <span>Page <span th:text="${currentPage != null ? currentPage : 1}"></span> of <span th:text="${totalPages}"></span></span>

            <!-- Next Button -->
            <a th:if="${currentPage != null && currentPage < totalPages}"
               th:href="@{/courses(selectedCourse=${selectedCourse}, selectedYear=${selectedYear}, currentPage=${currentPage + 1}, pageSize=${pageSize})}"
               class="btn btn-outline">â¡ï¸ Next</a>
            <span th:if="${currentPage == null || currentPage >= totalPages}" class="btn btn-outline disabled">â¡ï¸ Next</span>

            <!-- Last Button -->
            <a th:if="${currentPage != null && currentPage < totalPages}"
               th:href="@{/courses(selectedCourse=${selectedCourse}, selectedYear=${selectedYear}, currentPage=${totalPages}, pageSize=${pageSize})}"
               class="btn btn-outline">â­ï¸ Last</a>
            <span th:if="${currentPage == null || currentPage >= totalPages}" class="btn btn-outline disabled">â­ï¸ Last</span>
        </div>
    </div>

    <!-- Total Elements -->
    <div class="total-elements" th:if="${totalElements != null}">
        Total: <span th:text="${totalElements}"></span> course(s) found
    </div>
</div>

</body>
</html>
